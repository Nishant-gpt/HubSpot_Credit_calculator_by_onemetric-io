<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HubSpot Credits Calculator - OneMetric.io</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #F7F8FA;
      --surface: #FFFFFF;
      --text: #0B0C10;
      --muted: #5B6372;
      --border: #E7E9EE;
      --primary: #7C3AED;
      --accent: #5b2a85;
      --success: #16A34A;
      --danger: #EF4444;
      --shadow: 0 10px 30px rgba(0,0,0,.06);
      --radius: 16px;
      --radius-lg: 20px;
    }

    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow);
      height: 56px;
    }

    .header-content {
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 24px;
      height: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .header-left img {
      height: 28px;
    }

    .header-logo {
      color: var(--text);
      font-size: 15px;
    }

    .header-center h1 {
      font-size: 18px;
      font-weight: 700;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .btn {
      height: 36px;
      padding: 0 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      background: var(--surface);
      color: var(--text);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      transition: all 0.15s ease;
    }

    .btn:hover {
      background: var(--bg);
    }

    .btn--primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .btn--primary:hover {
      background: #5B2A85;
    }

    /* Main Layout */
    .main {
      max-width: 1440px;
      margin: 0 auto;
      padding: 32px 24px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 32px;
    }

    /* Sidebar */
    .sidebar {
      position: sticky;
      top: 88px;
      height: fit-content;
    }

    .sidebar h3 {
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 16px;
      letter-spacing: 0.5px;
    }

    .steps {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--surface);
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .step:hover {
      background: var(--bg);
    }

    .step--active {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(124,58,237,.12) inset;
      background: rgba(124,58,237,.05);
    }

    .step__icon {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    .step__label {
      flex: 1;
      font-weight: 600;
      font-size: 14px;
    }

    .step__badge {
      margin-left: auto;
      font-weight: 600;
      color: var(--muted);
      background: #F3F4F6;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 12px;
    }

    .step--active .step__badge {
      background: rgba(124,58,237,.15);
      color: var(--primary);
    }

    /* Content Card */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: 32px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
    }

    .card-title {
      flex: 1;
    }

    .h2 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .helper {
      color: var(--muted);
      font-size: 15px;
    }

    .section-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
    }

    .section-card h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    /* Tool Cards */
    .tool-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }

    .tool-card {
      border: 1px dashed var(--border);
      border-radius: 14px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.15s ease;
      background: var(--surface);
    }

    .tool-card:hover {
      border-style: solid;
      background: rgba(124,58,237,.02);
    }

    .tool-card--active {
      border-style: solid;
      border-color: var(--primary);
      background: rgba(124,58,237,.05);
    }

    .tool-card__icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .tool-card__name {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 4px;
    }

    .tool-card__help {
      font-size: 13px;
      color: var(--muted);
    }

    .tool-card__credits {
      font-size: 12px;
      color: var(--primary);
      font-weight: 600;
      margin-top: 8px;
    }

    /* Inputs */
    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 6px;
    }

    .input-help {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 8px;
    }

    input[type="number"], select {
      width: 100%;
      padding: 10px 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 15px;
      font-family: inherit;
      transition: all 0.15s ease;
    }

    input[type="number"]:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(124,58,237,.12);
    }

    .quick-chips {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .chip {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .chip:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Toggle Switch */
    .toggle-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: #F0F9FF;
      border: 1px solid #BAE6FD;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .toggle-label {
      flex: 1;
    }

    .toggle-label strong {
      display: block;
      margin-bottom: 4px;
    }

    .toggle-label small {
      color: var(--muted);
      font-size: 13px;
    }

    .toggle {
      position: relative;
      width: 48px;
      height: 24px;
      background: #CBD5E1;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .toggle.active {
      background: var(--accent);
    }

    .toggle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.2s;
    }

    .toggle.active::after {
      transform: translateX(24px);
    }

    /* Step Total */
    .step-total {
      background: rgba(124,58,237,.08);
      border: 1px solid rgba(124,58,237,.2);
      border-radius: 12px;
      padding: 14px 18px;
      color: var(--primary);
      font-weight: 600;
      font-size: 15px;
      margin-top: 20px;
    }

    /* Results */
    .result-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .result-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
    }

    .result-card__label {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .result-card__value {
      font-size: 32px;
      font-weight: 700;
    }

    .result-card__value.positive { color: var(--success); }
    .result-card__value.negative { color: var(--danger); }
    .result-card__value.neutral { color: var(--primary); }

    .top-drivers {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 24px;
    }

    .top-drivers h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .driver-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }

    .driver-item:last-child {
      border-bottom: none;
    }

    .driver-bar {
      flex: 1;
      height: 8px;
      background: #E5E7EB;
      border-radius: 4px;
      margin: 0 16px;
      overflow: hidden;
    }

    .driver-bar-fill {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .expansion-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }

    .option-card {
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      position: relative;
    }

    .option-card.recommended {
      border-color: var(--success);
      background: #F0FDF4;
    }

    .option-card__ribbon {
      position: absolute;
      top: -1px;
      right: 16px;
      background: var(--success);
      color: white;
      padding: 4px 12px;
      border-radius: 0 0 8px 8px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .option-card h4 {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .option-card__price {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary);
      margin: 12px 0;
    }

    .option-card__details {
      color: var(--muted);
      font-size: 13px;
    }

    .result-actions {
      display: flex;
      gap: 12px;
    }

    .result-actions .btn {
      flex: 1;
      justify-content: center;
      height: 44px;
    }

    /* Responsive */
    @media (max-width: 968px) {
      .main {
        grid-template-columns: 1fr;
        gap: 24px;
      }

      .sidebar {
        position: static;
      }

      .steps {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: 8px;
      }

      .step {
        flex-shrink: 0;
        min-width: 140px;
      }

      .result-grid {
        grid-template-columns: 1fr;
      }

      .expansion-options {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      .header-center h1 {
        font-size: 15px;
      }

      .header-actions {
        gap: 6px;
      }

      .header-actions .btn {
        font-size: 12px;
        padding: 0 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <img src="attached_assets/OneMetric Logo_1760030103016.png" alt="OneMetric.io" onerror="this.style.display='none'">
        <span class="header-logo">· Breeze</span>
      </div>
      <div class="header-center">
        <h1>HubSpot Credits Calculator</h1>
      </div>
      <div class="header-actions">
        <a href="https://ai-readiness-gauge-nishant85.replit.app/" class="btn">Take HubSpot AI Rediness assesment</a>
        <a href="https://www.onemetric.io" target="_blank" class="btn btn--primary">Talk to an Elite Partner</a>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="main">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h3>Calculator your AI Credits</h3>
      <div class="steps" id="steps"></div>
    </aside>

    <!-- Content -->
    <div class="card" id="content"></div>
  </main>

  <script>
    // State
    let state = {
      currentStep: 0,
      included: 500,
      hasDataHub: false,
      usage: {
        'customer-agent': 0,
        'prospecting-monitor-mode': 'direct',
        'prospecting-monitor-companies': 0,
        'prospecting-monitor-contacts-per-company': 2,
        'prospecting-monitor-meetings': 0,
        'prospecting-monitor-conversion': 5,
        'prospecting-agent-monitor-contact': 0,
        'prospecting-agent-company-research': 0,
        'data-agent-questions': 0,
        'data-agent-records': 0,
        'data-agent-refreshes': 1,
        'data-agent-text-response': 0,
        'workflow-ai-action-breeze': 0,
        'buyer-intent-targets': 0,
        'buyer-intent-additional': 0,
        'company-monitoring-intent': 0,
        'data-hub-size': 'small',
        'data-hub-destinations': 1,
        'data-hub-frequency': 1
      }
    };

    // Steps Configuration
    const steps = [
      { id: 'subscription', icon: '🏠', label: 'Your HubSpot Plan' },
      { id: 'customer-agent', icon: '💬', label: 'Customer Agent' },
      { id: 'prospecting', icon: '🎯', label: 'Prospecting Agent' },
      { id: 'data-agent', icon: '📊', label: 'Data Agent' },
      { id: 'buyer-intent', icon: '👁️', label: 'Buyer Intent' },
      { id: 'workflows', icon: '⚙️', label: 'Breeze Workflows' },
      { id: 'data-hub', icon: '💾', label: 'Data Hub' },
      { id: 'results', icon: '📈', label: 'Results' }
    ];

    // Calculate step totals
    function getStepTotal(stepId) {
      switch(stepId) {
        case 'subscription': return state.included;
        case 'customer-agent': return (state.usage['customer-agent'] || 0) * 100;
        case 'prospecting': 
          const monitor = (state.usage['prospecting-agent-monitor-contact'] || 0) * 100;
          const research = (state.usage['prospecting-agent-company-research'] || 0) * 10;
          return monitor + research;
        case 'data-agent': return (state.usage['data-agent-text-response'] || 0) * 10;
        case 'buyer-intent': return (state.usage['company-monitoring-intent'] || 0) * 10;
        case 'workflows': return (state.usage['workflow-ai-action-breeze'] || 0) * 10;
        case 'data-hub':
          const sizeMap = { small: 25, medium: 75, large: 200 };
          const size = state.usage['data-hub-size'] || 'small';
          const dest = state.usage['data-hub-destinations'] || 0;
          const freq = state.usage['data-hub-frequency'] || 0;
          return sizeMap[size] * dest * freq;
        case 'results': return getProjectedUsage();
        default: return 0;
      }
    }

    // Render sidebar
    function renderSidebar() {
      const container = document.getElementById('steps');
      container.innerHTML = steps.map((step, index) => `
        <div class="step ${state.currentStep === index ? 'step--active' : ''}" onclick="goToStep(${index})">
          <div class="step__icon">${step.icon}</div>
          <div class="step__label">${step.label}</div>
          <div class="step__badge">${getStepTotal(step.id).toLocaleString()}</div>
        </div>
      `).join('');
    }

    // Render content based on current step
    function renderContent() {
      const step = steps[state.currentStep];
      const container = document.getElementById('content');
      
      const nextButton = state.currentStep < steps.length - 1 
        ? `<button class="btn btn--primary" onclick="nextStep()">Next section →</button>`
        : '';

      let content = '';
      
      switch(step.id) {
        case 'subscription':
          content = renderSubscription();
          break;
        case 'customer-agent':
          content = renderCustomerAgent();
          break;
        case 'prospecting':
          content = renderProspecting();
          break;
        case 'data-agent':
          content = renderDataAgent();
          break;
        case 'buyer-intent':
          content = renderBuyerIntent();
          break;
        case 'workflows':
          content = renderWorkflows();
          break;
        case 'data-hub':
          content = renderDataHub();
          break;
        case 'results':
          content = renderResults();
          break;
      }

      container.innerHTML = `
        <div class="card-header">
          <div class="card-title">
            <h2 class="h2">${step.label}</h2>
          </div>
          ${nextButton}
        </div>
        ${content}
      `;
    }

    // Subscription Step
    function renderSubscription() {
      const tiers = [
        { id: 'starter', name: 'Starter', credits: 500 },
        { id: 'pro', name: 'Professional', credits: 3000 },
        { id: 'enterprise', name: 'Enterprise', credits: 5000 }
      ];

      const currentTier = tiers.find(t => t.credits === state.included) || tiers[0];

      return `
        <p class="helper">Select your current HubSpot subscription details.</p>
        
        <div class="section-card">
          <div class="toggle-wrapper">
            <div class="toggle-label">
              <strong>Customer is on Seats pricing</strong>
              <small>Enable to choose base credits granted with Seats Pricing</small>
            </div>
            <div class="toggle ${state.hasDataHub ? 'active' : ''}" onclick="toggleSeats()"></div>
          </div>

          <h3>Highest Product Edition</h3>
          <div class="tool-grid">
            ${tiers.map(tier => `
              <div class="tool-card ${currentTier.id === tier.id ? 'tool-card--active' : ''}" onclick="selectTier('${tier.id}', ${tier.credits})">
                <div class="tool-card__name">${tier.name}</div>
                <div class="tool-card__credits">${tier.credits.toLocaleString()} credits</div>
              </div>
            `).join('')}
          </div>

          ${state.hasDataHub ? `
            <h3 style="margin-top: 20px;">Data Hub Edition</h3>
            <div class="tool-grid">
              ${[
                { id: 'starter-dh', name: 'Starter', credits: 500 },
                { id: 'pro-dh', name: 'Professional', credits: 5000 },
                { id: 'enterprise-dh', name: 'Enterprise', credits: 10000 }
              ].map(tier => `
                <div class="tool-card" onclick="selectDataHubTier(${tier.credits})">
                  <div class="tool-card__name">${tier.name}</div>
                  <div class="tool-card__credits">${tier.credits.toLocaleString()} credits</div>
                </div>
              `).join('')}
            </div>
            <div style="background: #FEF3C7; border: 1px solid #FDE68A; border-radius: 12px; padding: 14px; margin-top: 16px; font-size: 13px;">
              <strong>💡 Active Credits Source</strong><br>
              Using the higher amount between Product Hub and Data Hub
            </div>
          ` : ''}
        </div>
      `;
    }

    // Customer Agent Step
    function renderCustomerAgent() {
      const conversations = state.usage['customer-agent'] || 0;
      const total = conversations * 100;

      return `
        <p class="helper">Estimate how many conversations across all channels per month.</p>
        
        <div class="section-card">
          <div class="input-group">
            <label class="input-label">Conversations per Month</label>
            <div class="input-help">Estimate how many conversations across all channels (chat, email, social) per month.</div>
            <input type="number" value="${conversations}" min="0" oninput="updateUsage('customer-agent', this.value)">
            <div class="quick-chips">
              <span class="chip" onclick="addQuick('customer-agent', 50)">+50</span>
              <span class="chip" onclick="addQuick('customer-agent', 100)">+100</span>
              <span class="chip" onclick="addQuick('customer-agent', 1000)">+1000</span>
            </div>
          </div>
          <div class="step-total">💳 This step: ${total.toLocaleString()} credits</div>
        </div>
      `;
    }

    // Prospecting Agent Step
    function renderProspecting() {
      const mode = state.usage['prospecting-monitor-mode'] || 'direct';
      const monitorTotal = (state.usage['prospecting-agent-monitor-contact'] || 0) * 100;
      const researchTotal = (state.usage['prospecting-agent-company-research'] || 0) * 10;
      const total = monitorTotal + researchTotal;

      return `
        <p class="helper">Estimate directly, or switch to Goal Mode to back-solve from meetings needed.</p>
        
        <div class="section-card">
          <h3>Monitor Contact Activity</h3>
          <div class="tool-grid">
            <div class="tool-card ${mode === 'direct' ? 'tool-card--active' : ''}" onclick="switchMode('direct')">
              <div class="tool-card__icon">📊</div>
              <div class="tool-card__name">Direct Input</div>
              <div class="tool-card__help">Enter companies and contacts directly</div>
            </div>
            <div class="tool-card ${mode === 'goal' ? 'tool-card--active' : ''}" onclick="switchMode('goal')">
              <div class="tool-card__icon">🎯</div>
              <div class="tool-card__name">Goal Mode</div>
              <div class="tool-card__help">Back-solve from meetings needed</div>
            </div>
          </div>

          ${mode === 'direct' ? `
            <div class="input-group">
              <label class="input-label">Companies to Monitor per Month</label>
              <input type="number" id="input-companies" value="${state.usage['prospecting-monitor-companies'] || 0}" min="0" oninput="updateProspecting()">
              <div class="quick-chips">
                <span class="chip" onclick="addQuickProspecting('companies', 50)">+50</span>
                <span class="chip" onclick="addQuickProspecting('companies', 100)">+100</span>
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">Contacts per Company</label>
              <input type="number" id="input-contacts" value="${state.usage['prospecting-monitor-contacts-per-company'] || 2}" min="1" oninput="updateProspecting()">
            </div>
          ` : `
            <div class="input-group">
              <label class="input-label">Meetings Needed per Month</label>
              <input type="number" id="input-meetings" value="${state.usage['prospecting-monitor-meetings'] || 0}" min="0" oninput="updateProspecting()">
              <div class="quick-chips">
                <span class="chip" onclick="addQuickProspecting('meetings', 10)">+10</span>
                <span class="chip" onclick="addQuickProspecting('meetings', 50)">+50</span>
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">Expected Conversion Rate (%)</label>
              <input type="number" id="input-conversion" value="${state.usage['prospecting-monitor-conversion'] || 5}" min="1" max="100" oninput="updateProspecting()">
            </div>
            <div class="input-group">
              <label class="input-label">Contacts per Company</label>
              <input type="number" id="input-contacts-goal" value="${state.usage['prospecting-monitor-contacts-per-company'] || 2}" min="1" oninput="updateProspecting()">
            </div>
            <div style="background: #F0F9FF; border: 1px solid #BAE6FD; border-radius: 10px; padding: 12px; font-size: 14px; margin-top: 12px;">
              📊 Calculated: <strong>${state.usage['prospecting-monitor-companies'] || 0} companies</strong> to monitor
            </div>
          `}
        </div>

        <div class="section-card">
          <h3>Company Research</h3>
          <div class="input-group">
            <label class="input-label">Research Results per Month</label>
            <input type="number" value="${state.usage['prospecting-agent-company-research'] || 0}" min="0" oninput="updateUsage('prospecting-agent-company-research', this.value)">
            <div class="quick-chips">
              <span class="chip" onclick="addQuick('prospecting-agent-company-research', 50)">+50</span>
              <span class="chip" onclick="addQuick('prospecting-agent-company-research', 100)">+100</span>
            </div>
          </div>
        </div>

        <div class="step-total">💳 This step: ${total.toLocaleString()} credits</div>
      `;
    }

    // Data Agent Step
    function renderDataAgent() {
      const questions = state.usage['data-agent-questions'] || 0;
      const records = state.usage['data-agent-records'] || 0;
      const refreshes = state.usage['data-agent-refreshes'] || 1;
      const total = questions * records * refreshes * 10;

      return `
        <p class="helper">Estimate AI questions asked about your data.</p>
        
        <div class="section-card">
          <div class="input-group">
            <label class="input-label">Questions per Record</label>
            <input type="number" id="input-questions" value="${questions}" min="0" oninput="updateDataAgent()">
            <div class="quick-chips">
              <span class="chip" onclick="addQuickDataAgent('questions', 1)">+1</span>
              <span class="chip" onclick="addQuickDataAgent('questions', 5)">+5</span>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">New Records per Month</label>
            <input type="number" id="input-records" value="${records}" min="0" oninput="updateDataAgent()">
            <div class="quick-chips">
              <span class="chip" onclick="addQuickDataAgent('records', 100)">+100</span>
              <span class="chip" onclick="addQuickDataAgent('records', 1000)">+1000</span>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">Refreshes per Month</label>
            <select id="input-refreshes" onchange="updateDataAgent()">
              <option value="1" ${refreshes === 1 ? 'selected' : ''}>Once (1)</option>
              <option value="4" ${refreshes === 4 ? 'selected' : ''}>Weekly (4)</option>
              <option value="30" ${refreshes === 30 ? 'selected' : ''}>Daily (30)</option>
            </select>
          </div>
          <div class="step-total">💳 This step: ${total.toLocaleString()} credits</div>
        </div>
      `;
    }

    // Buyer Intent Step
    function renderBuyerIntent() {
      const targets = state.usage['buyer-intent-targets'] || 0;
      const additional = state.usage['buyer-intent-additional'] || 0;
      const total = (targets + additional) * 10;

      return `
        <p class="helper">Monitor companies for buying signals.</p>
        
        <div class="section-card">
          <div class="input-group">
            <label class="input-label">Target Accounts</label>
            <input type="number" id="input-targets" value="${targets}" min="0" oninput="updateBuyerIntent()">
            <div class="quick-chips">
              <span class="chip" onclick="addQuickBuyerIntent('targets', 10)">+10</span>
              <span class="chip" onclick="addQuickBuyerIntent('targets', 50)">+50</span>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">Additional Companies</label>
            <input type="number" id="input-additional" value="${additional}" min="0" oninput="updateBuyerIntent()">
            <div class="quick-chips">
              <span class="chip" onclick="addQuickBuyerIntent('additional', 10)">+10</span>
              <span class="chip" onclick="addQuickBuyerIntent('additional', 50)">+50</span>
            </div>
          </div>
          <div class="step-total">💳 This step: ${total.toLocaleString()} credits</div>
        </div>
      `;
    }

    // Workflows Step
    function renderWorkflows() {
      const actions = state.usage['workflow-ai-action-breeze'] || 0;
      const total = actions * 10;

      return `
        <p class="helper">AI-powered workflow automation actions.</p>
        
        <div class="section-card">
          <div class="input-group">
            <label class="input-label">AI Actions per Month</label>
            <input type="number" value="${actions}" min="0" oninput="updateUsage('workflow-ai-action-breeze', this.value)">
            <div class="quick-chips">
              <span class="chip" onclick="addQuick('workflow-ai-action-breeze', 50)">+50</span>
              <span class="chip" onclick="addQuick('workflow-ai-action-breeze', 100)">+100</span>
              <span class="chip" onclick="addQuick('workflow-ai-action-breeze', 1000)">+1000</span>
            </div>
          </div>
          <div class="step-total">💳 This step: ${total.toLocaleString()} credits</div>
        </div>
      `;
    }

    // Data Hub Step
    function renderDataHub() {
      const size = state.usage['data-hub-size'] || 'small';
      const destinations = state.usage['data-hub-destinations'] || 1;
      const frequency = state.usage['data-hub-frequency'] || 1;
      const sizeMap = { small: 25, medium: 75, large: 200 };
      const total = sizeMap[size] * destinations * frequency;

      return `
        <p class="helper">Data synchronization and management.</p>
        
        <div class="section-card">
          <h3>Dataset Size</h3>
          <div class="tool-grid">
            ${Object.entries({ small: '< 500K rows', medium: '500K-5M rows', large: '> 5M rows' }).map(([key, label]) => `
              <div class="tool-card ${size === key ? 'tool-card--active' : ''}" onclick="selectDataHubSize('${key}')">
                <div class="tool-card__name">${label}</div>
                <div class="tool-card__credits">${sizeMap[key]} credits</div>
              </div>
            `).join('')}
          </div>

          <div class="input-group">
            <label class="input-label">Destinations</label>
            <input type="number" id="input-destinations" value="${destinations}" min="1" oninput="updateDataHubCalc()">
          </div>

          <div class="input-group">
            <label class="input-label">Sync Frequency</label>
            <select id="input-frequency" onchange="updateDataHubCalc()">
              <option value="1" ${frequency === 1 ? 'selected' : ''}>One-time (1)</option>
              <option value="1" ${frequency === 1 ? 'selected' : ''}>Monthly (1)</option>
              <option value="30" ${frequency === 30 ? 'selected' : ''}>Daily (30)</option>
              <option value="700" ${frequency === 700 ? 'selected' : ''}>Hourly (700)</option>
              <option value="2900" ${frequency === 2900 ? 'selected' : ''}>Fifteen-min (2900)</option>
            </select>
          </div>

          <div class="step-total">💳 This step: ${total.toLocaleString()} credits</div>
        </div>
      `;
    }

    // Results Step
    function renderResults() {
      const included = state.included;
      const projected = getProjectedUsage();
      const net = included - projected;

      // Get top 3 drivers
      const drivers = [
        { name: 'Customer Agent', credits: getStepTotal('customer-agent') },
        { name: 'Prospecting Agent', credits: getStepTotal('prospecting') },
        { name: 'Data Agent', credits: getStepTotal('data-agent') },
        { name: 'Buyer Intent', credits: getStepTotal('buyer-intent') },
        { name: 'Breeze Workflows', credits: getStepTotal('workflows') },
        { name: 'Data Hub', credits: getStepTotal('data-hub') }
      ].sort((a, b) => b.credits - a.credits).slice(0, 3);

      const maxCredits = drivers[0]?.credits || 1;

      return `
        <p class="helper">Included vs. projected vs. expansion—at a glance.</p>
        
        <div class="result-grid">
          <div class="result-card">
            <div class="result-card__label">Included Credits</div>
            <div class="result-card__value neutral">${included.toLocaleString()}</div>
          </div>
          <div class="result-card">
            <div class="result-card__label">Projected Usage</div>
            <div class="result-card__value neutral">${projected.toLocaleString()}</div>
          </div>
          <div class="result-card">
            <div class="result-card__label">Net Balance</div>
            <div class="result-card__value ${net >= 0 ? 'positive' : 'negative'}">${net.toLocaleString()}</div>
          </div>
        </div>

        <div class="top-drivers">
          <h3>Top Credit Drivers</h3>
          ${drivers.map(driver => `
            <div class="driver-item">
              <strong style="min-width: 140px;">${driver.name}</strong>
              <div class="driver-bar">
                <div class="driver-bar-fill" style="width: ${(driver.credits / maxCredits * 100)}%"></div>
              </div>
              <span style="font-weight: 600; min-width: 80px; text-align: right;">${driver.credits.toLocaleString()}</span>
              <span style="color: var(--muted); min-width: 50px; text-align: right;">${projected > 0 ? Math.round(driver.credits / projected * 100) : 0}%</span>
            </div>
          `).join('')}
        </div>

        ${net < 0 ? `
          ${(() => {
            const deficit = Math.abs(net);
            const capacityPacks = Math.ceil(deficit / 1000);
            const capacityCost = capacityPacks * 10;
            const overageCost = Math.ceil(deficit / 10) * 0.10;
            const recommended = capacityCost <= overageCost ? 'capacity' : 'overage';

            return `
              <div class="expansion-options">
                <div class="option-card ${recommended === 'capacity' ? 'recommended' : ''}">
                  ${recommended === 'capacity' ? '<div class="option-card__ribbon">RECOMMENDED</div>' : ''}
                  <h4>Capacity Packs</h4>
                  <div class="option-card__price">$${capacityCost.toFixed(2)}</div>
                  <div class="option-card__details">${capacityPacks} pack${capacityPacks > 1 ? 's' : ''} × $10<br>Best for consistent overages</div>
                </div>
                <div class="option-card ${recommended === 'overage' ? 'recommended' : ''}">
                  ${recommended === 'overage' ? '<div class="option-card__ribbon">RECOMMENDED</div>' : ''}
                  <h4>Overage</h4>
                  <div class="option-card__price">$${overageCost.toFixed(2)}</div>
                  <div class="option-card__details">$0.01 per credit<br>Best for occasional spikes</div>
                </div>
              </div>
            `;
          })()}
        ` : `
          <div style="background: #F0FDF4; border: 1px solid #BBF7D0; border-radius: 16px; padding: 24px; text-align: center;">
            <h3 style="color: var(--success); margin-bottom: 8px;">✅ You're all set!</h3>
            <p style="color: var(--muted);">Your current plan includes enough credits for your projected usage.</p>
          </div>
        `}

        <div class="result-actions">
          <button class="btn" onclick="exportCSV()">📥 Export CSV</button>
          <button class="btn" onclick="shareURL()">🔗 Share</button>
          <button class="btn" onclick="resetCalculator()">🔄 Reset</button>
        </div>
      `;
    }

    // Navigation
    function goToStep(index) {
      state.currentStep = index;
      render();
    }

    function nextStep() {
      if (state.currentStep < steps.length - 1) {
        state.currentStep++;
        render();
      }
    }

    // Update Functions
    function updateUsage(id, value) {
      state.usage[id] = parseInt(value) || 0;
      render();
    }

    function addQuick(id, amount) {
      state.usage[id] = (state.usage[id] || 0) + amount;
      render();
    }

    function toggleSeats() {
      state.hasDataHub = !state.hasDataHub;
      renderContent();
    }

    function selectTier(id, credits) {
      state.included = credits;
      render();
    }

    function selectDataHubTier(credits) {
      if (credits > state.included) {
        state.included = credits;
      }
      render();
    }

    function switchMode(mode) {
      state.usage['prospecting-monitor-mode'] = mode;
      renderContent();
    }

    function updateProspecting() {
      const mode = state.usage['prospecting-monitor-mode'] || 'direct';
      
      if (mode === 'direct') {
        const companies = parseInt(document.getElementById('input-companies')?.value) || 0;
        const contacts = parseInt(document.getElementById('input-contacts')?.value) || 2;
        state.usage['prospecting-monitor-companies'] = companies;
        state.usage['prospecting-monitor-contacts-per-company'] = contacts;
        state.usage['prospecting-agent-monitor-contact'] = companies * contacts;
      } else {
        const meetings = parseInt(document.getElementById('input-meetings')?.value) || 0;
        const conversion = parseInt(document.getElementById('input-conversion')?.value) || 5;
        const contacts = parseInt(document.getElementById('input-contacts-goal')?.value) || 2;
        const companies = Math.ceil(meetings / (conversion / 100));
        
        state.usage['prospecting-monitor-meetings'] = meetings;
        state.usage['prospecting-monitor-conversion'] = conversion;
        state.usage['prospecting-monitor-contacts-per-company'] = contacts;
        state.usage['prospecting-monitor-companies'] = companies;
        state.usage['prospecting-agent-monitor-contact'] = companies * contacts;
      }
      
      render();
    }

    function addQuickProspecting(field, amount) {
      const mode = state.usage['prospecting-monitor-mode'] || 'direct';
      if (mode === 'direct' && field === 'companies') {
        state.usage['prospecting-monitor-companies'] = (state.usage['prospecting-monitor-companies'] || 0) + amount;
      } else if (mode === 'goal' && field === 'meetings') {
        state.usage['prospecting-monitor-meetings'] = (state.usage['prospecting-monitor-meetings'] || 0) + amount;
      }
      updateProspecting();
    }

    function updateDataAgent() {
      const questions = parseInt(document.getElementById('input-questions')?.value) || 0;
      const records = parseInt(document.getElementById('input-records')?.value) || 0;
      const refreshes = parseInt(document.getElementById('input-refreshes')?.value) || 1;
      
      state.usage['data-agent-questions'] = questions;
      state.usage['data-agent-records'] = records;
      state.usage['data-agent-refreshes'] = refreshes;
      state.usage['data-agent-text-response'] = questions * records * refreshes;
      
      render();
    }

    function addQuickDataAgent(field, amount) {
      state.usage[`data-agent-${field}`] = (state.usage[`data-agent-${field}`] || 0) + amount;
      updateDataAgent();
    }

    function updateBuyerIntent() {
      const targets = parseInt(document.getElementById('input-targets')?.value) || 0;
      const additional = parseInt(document.getElementById('input-additional')?.value) || 0;
      
      state.usage['buyer-intent-targets'] = targets;
      state.usage['buyer-intent-additional'] = additional;
      state.usage['company-monitoring-intent'] = targets + additional;
      
      render();
    }

    function addQuickBuyerIntent(field, amount) {
      state.usage[`buyer-intent-${field}`] = (state.usage[`buyer-intent-${field}`] || 0) + amount;
      updateBuyerIntent();
    }

    function selectDataHubSize(size) {
      state.usage['data-hub-size'] = size;
      render();
    }

    function updateDataHubCalc() {
      const destinations = parseInt(document.getElementById('input-destinations')?.value) || 1;
      const frequency = parseInt(document.getElementById('input-frequency')?.value) || 1;
      
      state.usage['data-hub-destinations'] = destinations;
      state.usage['data-hub-frequency'] = frequency;
      
      render();
    }

    // Calculate Totals
    function getProjectedUsage() {
      let total = 0;
      
      total += (state.usage['customer-agent'] || 0) * 100;
      total += (state.usage['prospecting-agent-monitor-contact'] || 0) * 100;
      total += (state.usage['prospecting-agent-company-research'] || 0) * 10;
      total += (state.usage['data-agent-text-response'] || 0) * 10;
      total += (state.usage['workflow-ai-action-breeze'] || 0) * 10;
      total += (state.usage['company-monitoring-intent'] || 0) * 10;
      
      const sizeMap = { small: 25, medium: 75, large: 200 };
      const size = state.usage['data-hub-size'] || 'small';
      const destinations = state.usage['data-hub-destinations'] || 0;
      const frequency = state.usage['data-hub-frequency'] || 0;
      total += sizeMap[size] * destinations * frequency;
      
      return total;
    }

    // URL State Management
    function shareURL() {
      const stateStr = btoa(JSON.stringify(state));
      const url = `${window.location.origin}${window.location.pathname}#${stateStr}`;
      navigator.clipboard.writeText(url).then(() => {
        alert('✅ Calculator URL copied to clipboard!');
      });
    }

    function loadFromURL() {
      const hash = window.location.hash.slice(1);
      if (hash) {
        try {
          const loadedState = JSON.parse(atob(hash));
          state = { ...state, ...loadedState };
        } catch (e) {
          console.error('Failed to load state from URL');
        }
      }
    }

    // Export CSV
    function exportCSV() {
      const rows = [
        ['Feature', 'Usage', 'Credits per Unit', 'Total Credits'],
        ['Customer Agent', state.usage['customer-agent'] || 0, 100, (state.usage['customer-agent'] || 0) * 100],
        ['Prospecting Monitor', state.usage['prospecting-agent-monitor-contact'] || 0, 100, (state.usage['prospecting-agent-monitor-contact'] || 0) * 100],
        ['Prospecting Research', state.usage['prospecting-agent-company-research'] || 0, 10, (state.usage['prospecting-agent-company-research'] || 0) * 10],
        ['Data Agent', state.usage['data-agent-text-response'] || 0, 10, (state.usage['data-agent-text-response'] || 0) * 10],
        ['Breeze Workflows', state.usage['workflow-ai-action-breeze'] || 0, 10, (state.usage['workflow-ai-action-breeze'] || 0) * 10],
        ['Buyer Intent', state.usage['company-monitoring-intent'] || 0, 10, (state.usage['company-monitoring-intent'] || 0) * 10],
        ['', '', '', ''],
        ['Summary', '', '', ''],
        ['Included Credits', state.included, '', ''],
        ['Projected Usage', getProjectedUsage(), '', ''],
        ['Net Balance', state.included - getProjectedUsage(), '', '']
      ];

      const csv = rows.map(row => row.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'hubspot-credits-calculator.csv';
      a.click();
    }

    // Reset
    function resetCalculator() {
      if (confirm('Reset all values? This cannot be undone.')) {
        state = { 
          currentStep: 0, 
          included: 500, 
          hasDataHub: false,
          usage: {
            'customer-agent': 0,
            'prospecting-monitor-mode': 'direct',
            'prospecting-monitor-companies': 0,
            'prospecting-monitor-contacts-per-company': 2,
            'prospecting-monitor-meetings': 0,
            'prospecting-monitor-conversion': 5,
            'prospecting-agent-monitor-contact': 0,
            'prospecting-agent-company-research': 0,
            'data-agent-questions': 0,
            'data-agent-records': 0,
            'data-agent-refreshes': 1,
            'data-agent-text-response': 0,
            'workflow-ai-action-breeze': 0,
            'buyer-intent-targets': 0,
            'buyer-intent-additional': 0,
            'company-monitoring-intent': 0,
            'data-hub-size': 'small',
            'data-hub-destinations': 1,
            'data-hub-frequency': 1
          }
        };
        render();
      }
    }

    // Main Render
    function render() {
      renderSidebar();
      renderContent();
    }

    // Initialize
    function init() {
      loadFromURL();
      render();
    }

    init();
  </script>
</body>
</html>
